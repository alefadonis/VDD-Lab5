<!DOCTYPE html>
<html lang="en" style="height: 100%">
  <head>
    <meta charset="utf-8" />
    <style>
      html,
      body,
      form,
      fieldset,
      table,
      tr,
      td,
      img {
        margin: 0;
        padding: 0;
        font-size: 100%;
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      }

      table {
        width: 100%;
        margin: 0;
        padding: 0;
        border-spacing: 0;
        background-color: #f8f9fa;
      }

      table td {
        padding: 10px 20px;
        font-size: 0.9em;
        color: #555;
      }

      table tr:first-child td {
        border-bottom: 1px solid #ddd;
      }

      table td:last-child {
        text-align: right;
      }

      #header h2 {
        text-align: center;
        font-size: 1.8em;
        color: #343a40;
        margin-top: 20px;
      }

      #header h4 {
        text-align: center;
        font-size: 1.2em;
        margin-top: -10px;
        color: #6c757d;
      }

      #header p {
        margin-bottom: 0;
        text-align: center;
        color: #6c757d;
      }

      #header p.resumo {
        text-align: justify;
        padding: 20px 50px;
        color: #495057;
        line-height: 1.5em;
      }

      #container {
        max-width: 100%;
        height: 470px;
        padding: 20px 50px;
      }

      #footer {
        background-color: #f8f9fa;
        padding: 20px 50px;
        font-size: 0.9em;
        color: #6c757d;
      }

      #footer p {
        font-weight: bold;
        margin-bottom: 10px;
      }

      #footer ul {
        list-style-type: disc;
        margin-left: 20px;
        padding-left: 20px;
      }

      #footer ul li {
        margin-bottom: 5px;
      }

      .echarts-tooltip {
        border-radius: 4px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        padding: 10px;
        background-color: #fff;
        color: #343a40;
        font-size: 0.9em;
      }

      @media screen and (max-width: 768px) {
        #container {
          padding: 10px 20px;
        }

        #footer {
          padding: 10px 20px;
        }

        #header p.resumo {
          padding: 10px 20px;
        }
      }
    </style>
  </head>

  <body style="width: 100%; height: 100%; margin: 0">
    <table style="width: 100%; margin: 0px; padding: 0px; border-width: 0px">
      <tbody>
        <tr height="10px">
          <td>UNIVERSIDADE FEDERAL DE CAMPINA GRANDE - UFCG</td>
          <td style="text-align: right">
            Disciplina: Visualização de Dados (TECC)
          </td>
        </tr>
        <tr>
          <td>CENTRO DE ENGENHARIA ELÉTRICA E INFORMÁTICA - CEEI</td>
          <td style="text-align: right">
            Professor: Maxwell Guimarães de Oliveira
          </td>
        </tr>
        <tr>
          <td>UNIDADE ACADÊMICA DE SISTEMAS E COMPUTAÇÃO - UASC</td>
          <td style="text-align: right">Período: 2023.2</td>
        </tr>
      </tbody>
    </table>

    <div id="header">
      <h2 style="text-align: center">
        Projeto de Visualização Interativa de Dados
      </h2>
      <h4 style="text-align: center">
        <u>Grupo F</u>: Álef Carlos, João Uchôa, José Combé, José Neto, Laysa
        Silva&nbsp;
      </h4>
    </div>

    <div
      id="container_pie"
      style="max-width: 100%; height: 25px; padding: 10px 50px 10px 50px"
    ></div>
    <div
      id="container_line"
      style="max-width: 100%; height: 500px; padding: 10px 50px 10px 50px"
    ></div>

    <script
      type="text/javascript"
      src="https://fastly.jsdelivr.net/npm/jquery@3.7.1/dist/jquery.min.js"
    ></script>
    <script
      type="text/javascript"
      src="https://fastly.jsdelivr.net/npm/echarts@5.5.0/dist/echarts.min.js"
    ></script>
    <script
      type="text/javascript"
      src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"
    ></script>

    <script type="text/javascript">
      function processCSVData(data) {
        const categoryTranslationMap = {
          Furniture: "Móveis",
          Electronics: "Eletrônicos",
          Groceries: "Mantimentos",
          Clothing: "Vestuário",
        };

        var categories = {};
        var yearlySales = {};

        data.forEach(function (row) {
          var date = new Date(row["Date"]);
          var year = date.getFullYear();
          var category = categoryTranslationMap[row["Product Category"]];

          if (!category) {
            return; // Pula para a próxima iteração se a categoria não for válida
          }

          var revenue = parseFloat(row["Sales Revenue (USD)"]);

          // Acumular vendas por categoria
          if (!categories[category]) {
            categories[category] = 0;
          }
          categories[category] += revenue;

          // Acumular vendas por categoria ao longo dos anos
          if (!yearlySales[year]) {
            yearlySales[year] = {};
          }
          if (!yearlySales[year][category]) {
            yearlySales[year][category] = 0;
          }
          yearlySales[year][category] += revenue;
        });

        return { categories, yearlySales };
      }

      // Função para carregar o arquivo CSV
      function loadCSV(csvUrl) {
        Papa.parse(csvUrl, {
          download: true,
          header: true,
          complete: function (results) {
            var parsedData = processCSVData(results.data);
            createLineChart(parsedData.yearlySales);
          },
        });
      }

      function createPieChartForTooltip(containerId, data) {
        var pieChart = echarts.init(
          document.getElementById(containerId),
          null,
          {
            width: 300,
            height: 250,
          }
        );
        var pieOption = {
          series: [
            {
              name: "Vendas",
              type: "pie",
              radius: "60%",
              label: {
                show: true,
                formatter: "{d}%",
                textStyle: {
                  color: "#343a40",
                  fontSize: 14,
                },
              },
              labelLine: {
                show: true,
                smooth: true,
                length: 5,
                length2: 5,
              },
              data: Object.keys(data).map(function (key) {
                return { name: key, value: data[key] };
              }),
            },
          ],
        };
        pieChart.setOption(pieOption);
        return pieChart.getDataURL();
      }

      function createLineChart(yearlySales) {
        var lineChart = echarts.init(document.getElementById("container_line"));
        var years = Object.keys(yearlySales);
        var categories = new Set();

        years.forEach(function (year) {
          Object.keys(yearlySales[year]).forEach(function (category) {
            categories.add(category);
          });
        });

        var seriesData = Array.from(categories).map((category) => ({
          name: category,
          type: "line",
          data: years.map((year) => yearlySales[year][category] || 0),
        }));

        var lineOption = {
          title: {
            text: "Análise das Vendas por Categoria de Produtos (2022-2023)",
            left: "center",
          },
          tooltip: {
            trigger: "axis",
            axisPointer: {
              type: "cross",
            },
            formatter: function (params) {
              var year = params[0].axisValue;
              var salesForYear = yearlySales[year] || {};

              var sortedSales = Object.keys(salesForYear)
                .map((category) => ({
                  category,
                  value: salesForYear[category],
                }))
                .sort((a, b) => b.value - a.value);

              var pieDiv = document.createElement("div");
              pieDiv.style.width = "300px";
              pieDiv.style.height = "250px";
              pieDiv.id = "tooltip-pie-chart";
              pieDiv.style.margin = "10px auto";

              setTimeout(function () {
                createPieChartForTooltip(pieDiv.id, salesForYear);
              }, 10);

              var content = `<strong>${year}</strong><br/>`;
              sortedSales.forEach(function (item) {
                const matchingParam = params.find(
                  (param) => param.seriesName === item.category
                );
                const marker = matchingParam ? matchingParam.marker : "";

                content += `${marker}${item.category}: ${Math.round(
                  item.value
                ).toLocaleString()}<br/>`;
              });

              return content + `<br/>` + pieDiv.outerHTML;
            },
            backgroundColor: "#fff",
            textStyle: {
              color: "#343a40",
              fontSize: 18,
            },
            extraCssText:
              "padding: 15px; box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);",
          },
          legend: {
            data: Array.from(categories),
            top: "bottom",
          },
          xAxis: {
            type: "category",
            data: years,
          },
          yAxis: {
            type: "value",
          },
          series: seriesData,
        };

        lineChart.setOption(lineOption);
      }

      loadCSV("Retail_sales.csv");
    </script>

    <div id="footer">
      <p>Resumo:</p>
      <p class="resumo">
        Essa visualização mostra a distribuição de vendas por categoria de
        produto e a variação ao longo dos anos de 2022 a 2024, permitindo uma
        análise clara das tendências de vendas e do comportamento de diferentes
        categorias no mercado.
      </p>
      <ul>
        <li>
          Interaja com o gráfico de linha passando o mouse sobre os pontos para
          ver as vendas detalhadas por categoria em cada ano.
        </li>
        <li>
          Visualize um gráfico de pizza que aparece no tooltip, mostrando a
          distribuição percentual de vendas por categoria ao passar o mouse
          sobre os anos.
        </li>
        <li>
          Explore a evolução das vendas ao longo dos anos através do gráfico
          interativo.
        </li>
      </ul>
    </div>
  </body>
</html>
